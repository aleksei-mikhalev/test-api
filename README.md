# –¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ: API
üöÄ PHP 8   üèó MySQL  üìã PhpMyAdmin  üêã Docker

___

## –ü–æ—Ä—Ç—ã

- 3307 - MySQL
- 8081 - PhpMyAdmin
- 8080 - API App

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```shell
git clone git@github.com:realslane/Docker-API-Test.git api
cd api
docker-compose -p api up --build
```

- API app [http://localhost:8080](http://localhost:8080)
- PhpMyAdmin [http://localhost:8081](http://localhost:8081)

## –ü—Ä–∏–º–µ—Ä—ã URL –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

–ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å –∫–æ—à–µ–ª—å–∫–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å ID = 1:

http://localhost:8080/balance/get/1

–ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ—à–µ–ª—å–∫–∞ (ID = 1) –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

http://localhost:8080/balance/get_wallet/1

–£–≤–µ–ª–∏—á–∏—Ç—å (debit) –±–∞–ª–∞–Ω—Å RUB-–∫–æ—à–µ–ª—å–∫–∞ —Å ID = 5 –Ω–∞ —Å—É–º–º—É 50.55 —Ä—É–±. —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø—Ä–∏—á–∏–Ω—ã 'refund':

http://localhost:8080/balance/change/?wallet_id=5&type=debit&amount=50.55&curency=RUB&reason=refund


–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤–∞–ª—é—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ –∫—É—Ä—Å—É –∏–∑ —Ç–∞–±–ª–∏—Ü—ã exchange_rates.

–£–º–µ–Ω—å—à–∏—Ç—å (credit) –±–∞–ª–∞–Ω—Å RUB-–∫–æ—à–µ–ª—å–∫–∞ —Å ID = 5 (RUB-–∫–æ—à–µ–ª–µ–∫) –Ω–∞ —Å—É–º–º—É $20.31 —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø—Ä–∏—á–∏–Ω—ã 'stock':

http://localhost:8080/balance/change/?wallet_id=5&type=credit&amount=20.31&curency=USD&reason=stock

–£–≤–µ–ª–∏—á–∏—Ç—å (debit) –±–∞–ª–∞–Ω—Å USD-–∫–æ—à–µ–ª—å–∫–∞ —Å ID = 1 (USD-–∫–æ—à–µ–ª–µ–∫) –Ω–∞ —Å—É–º–º—É 65 —Ä—É–±. —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø—Ä–∏—á–∏–Ω—ã 'refund':

http://localhost:8080/balance/change/?wallet_id=1&type=debit&amount=65&curency=RUB&reason=stock

## –î–æ–ø. –∑–∞–¥–∞–Ω–∏–µ: SQL –∑–∞–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π –≤–µ—Ä–Ω–µ—Ç —Å—É–º–º—É, –ø–æ–ª—É—á–µ–Ω–Ω—É—é –ø–æ –ø—Ä–∏—á–∏–Ω–µ refund –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
```shell
SELECT SUM(amount) as `sum`
  FROM `transaction_log` as `tl`
  JOIN `reasons` as `r` ON `r`.`id` = `tl`.`reason`
 WHERE `r`.`name` = 'refund'
   AND `tl`.`date_update` >= DATE(NOW() - INTERVAL 7 DAY)
```

## –û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Ä–µ—à–µ–Ω–∏–π

–î–∞–º–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ñ–∞–π–ª–µ dump.sql
–ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ —á–µ—Ä–µ–∑ docker-compose.

–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã –ë–î —Å–¥–µ–ª–∞–Ω—ã —Å –ø–æ–º–æ—â—å—é –∏–Ω–¥–µ–∫—Å–æ–≤ (—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ, –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏).
–ù–∞–ø—Ä–∏–º–µ—Ä, —Ç–∞–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ –æ–¥–Ω–æ–º—É —Ç–∏–ø—É –∫–æ—à–µ–ª–æ–≤ (USD –∏ RUB) –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–†–∞–∑—Ä–µ—à–µ–Ω—ã–µ –≤–∞–ª—é—Ç—ã –ø–æ–º–µ—á–∞—é—Ç—Å—è –ø–æ–ª–µ–º enabled –≤ —Ç–∞–±–ª–∏—Ü–µ currencies.

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤ —Ç–∞–±–ª–∏—Ü–µ —Ç–æ–ª—å–∫–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ (currencies.enabled) –∫–æ—à–µ–ª—å–∫–∏
–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç—Ä–∏–≥–≥–µ—Ä check_enabled –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã wallets.

–ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫—É –º–µ—Ç–æ–¥–∞ POST –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –±–∞–ª–∞–Ω—Å–∞ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —Ç–µ—Ç—Å–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ—Ç–æ–¥–æ–º GET –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ.
–ï—Å–ª–∏ —Ä–∞—Å—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤ —Ñ–∞–π–ª–µ web\src\API\Balance.php (—Å—Ç—Ä–æ–∫–∏ 90-95),
—Ç–æ –±—É–¥—É—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–æ–ª—å–∫–æ POST-–∑–∞–ø—Ä–æ—Å—ã —Å —Å–æ–æ—Ç–≤–µ—Ç—Å–≤—É—é—â–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (–Ω–∞–∑–≤–∞–Ω–∏—è —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å GET-–ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏).

## –ò—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç –∑–∞–¥–∞—á–∏

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ—à–µ–ª—å–∫–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∫–æ—à–µ–ª–µ–∫.
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –≤–∞–ª—é—Ç—ã: USD –∏ RUB.
- –ü—Ä–∏ –≤—ã–∑–æ–≤–µ –º–µ—Ç–æ–¥–∞ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞ –Ω–∞ —Å—É–º–º—É —Å –æ—Ç–ª–∏—á–Ω–æ–π –≤–∞–ª—é—Ç–æ–π –æ—Ç –≤–∞–ª—é—Ç—ã –∫–æ—à–µ–ª—å–∫–∞, —Å—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø–æ –∫—É—Ä—Å—É.
- –ö—É—Ä—Å—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏.
- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞ –¥–æ–ª–∂–Ω—ã —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ –ë–î.

–ú–µ—Ç–æ–¥ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–µ—Ç–æ–¥–∞:
- ID –∫–æ—à–µ–ª—å–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 241, 242)
- –¢–∏–ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (debit –∏–ª–∏ credit)
- –°—É–º–º–∞, –Ω–∞ –∫–æ—Ç–æ—Ä—É—é –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å
- –í–∞–ª—é—Ç–∞ —Å—É–º–º—ã (–¥–æ–ø—É—Å—Ç–∏–º—ã –∑–Ω–∞—á–µ–Ω–∏—è: USD, RUB)
- –ü—Ä–∏—á–∏–Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—á–µ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: stock, refund). –°–ø–∏—Å–æ–∫ –ø—Ä–∏—á–∏–Ω —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω.

–ú–µ—Ç–æ–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞
–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–µ—Ç–æ–¥–∞:
- ID –∫–æ—à–µ–ª—å–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 241, 242)

SQL –∑–∞–ø—Ä–æ—Å
–ù–∞–ø–∏—Å–∞—Ç—å SQL –∑–∞–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π –≤–µ—Ä–Ω–µ—Ç —Å—É–º–º—É, –ø–æ–ª—É—á–µ–Ω–Ω—É—é –ø–æ –ø—Ä–∏—á–∏–Ω–µ refund –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π.

–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- –°–µ—Ä–≤–µ—Ä–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∞ –Ω–∞ PHP –≤–µ—Ä—Å–∏–∏ >=7.0
- –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–æ–ª–∂–Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –°–£–ë–î
- –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞

–î–æ–ø—É—â–µ–Ω–∏—è
- –í—ã–±–æ—Ä –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω;
- –í—Å–µ —Å–ø–æ—Ä–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –≤ –∑–∞–¥–∞—á–µ –º–æ–∂–µ—Ç –∏ –¥–æ–ª–∂–µ–Ω —Ä–µ—à–∞—Ç—å –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å;
